{% extends "base.html" %}
{% block content %}
<h2>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>

{# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ #}
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">{{ user_stats.total_cards }}</h5>
                <p class="card-text">–í—Å–µ–≥–æ —Å–ª–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">{{ user_stats.review_success_rate }}%</h5>
                <p class="card-text">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">{{ user_stats.tests_accuracy|floatformat:1 }}%</h5>
                <p class="card-text">–¢–æ—á–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤</p>
            </div>
        </div>
    </div>
</div>

{# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º #}
<div class="row mb-4">
    {# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º #}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>üìö –°–ª–æ–≤–∞ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏</h5>
            </div>
            <div class="card-body">
                {% if card_recommendations %}
                    <ul class="list-unstyled">
                        {% for rec in card_recommendations %}
                        <li class="mb-2">
                            <i class="bi bi-lightbulb text-warning"></i>
                            {{ rec }}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-success">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏!</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    {# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º #}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>üîÑ –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</h5>
            </div>
            <div class="card-body">
                {% if review_recommendations %}
                    <ul class="list-unstyled">
                        {% for rec in review_recommendations %}
                        <li class="mb-2">
                            <i class="bi bi-lightbulb text-warning"></i>
                            {{ rec }}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-success">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏!</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    {# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∞–º #}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>üìù –¢–µ—Å—Ç—ã</h5>
            </div>
            <div class="card-body">
                {% if test_recommendations %}
                    <ul class="list-unstyled">
                        {% for rec in test_recommendations %}
                        <li class="mb-2">
                            <i class="bi bi-lightbulb text-warning"></i>
                            {{ rec }}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-success">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ç–µ—Å—Ç–∞–º–∏!</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{# –°–ª–æ–≤–∞, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è #}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>‚ö†Ô∏è –°–ª–æ–≤–∞, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è</h5>
            </div>
            <div class="card-body">
                {% if weak_cards %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–°–ª–æ–≤–æ</th>
                                    <th>–ü–µ—Ä–µ–≤–æ–¥</th>
                                    <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for repetition in weak_cards %}
                                <tr>
                                    <td>{{ repetition.card.word }}</td>
                                    <td>{{ repetition.card.translation }}</td>
                                    <td>
                                        <span class="badge {% if repetition.card.level == 'beginner' %}bg-success{% elif repetition.card.level == 'intermediate' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ repetition.card.get_level_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge {% if repetition.success_rate >= 70 %}bg-success{% elif repetition.success_rate >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ repetition.success_rate }}%
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{% url 'words:review_card' repetition.card.pk %}" class="btn btn-sm btn-primary">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-success">–í—Å–µ —Å–ª–æ–≤–∞ —Ö–æ—Ä–æ—à–æ —É—Å–≤–∞–∏–≤–∞—é—Ç—Å—è!</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{# –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ #}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>üìã –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
            </div>
            <div class="card-body">
                {% if all_recommendations %}
                    <div class="row">
                        {% for rec in all_recommendations %}
                        <div class="col-md-6 mb-2">
                            <div class="alert alert-info">
                                <i class="bi bi-lightbulb text-warning"></i>
                                {{ rec }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{# –ù–∞–≤–∏–≥–∞—Ü–∏—è #}
<div class="row">
    <div class="col-12">
        <div class="d-flex gap-2">
            <a href="{% url 'stats:dashboard' %}" class="btn btn-primary">–ù–∞–∑–∞–¥ –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ</a>
            <a href="{% url 'stats:charts' %}" class="btn btn-info">–ì—Ä–∞—Ñ–∏–∫–∏</a>
            <a href="{% url 'stats:test_history' %}" class="btn btn-success">–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤</a>
        </div>
    </div>
</div>
{% endblock %} 